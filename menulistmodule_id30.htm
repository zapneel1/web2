


<!DOCTYPE html>
<html>
    <head>
        
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>Welcome Swapneel Layek to ERP, IIT Kharagpur</title>
        <meta charset="windows-1252">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
        <link rel="stylesheet" href="font-awesome/css/font-awesome.min.css">
        <script src="jquery/jquery-1.10.2.js"></script>
        <script src="bootstrap/js/bootstrap.min.js"></script>
        
        <style>
            body { padding-bottom: 70px; }
            .panel-heading.accordion-toggle:before {           
            /* symbol for "opening" panels */

            font-family:'FontAwesome';
            content:"\f146";
            float: left;
            padding-right: 10px;
            color: grey;
            }

            .panel-heading.accordion-toggle.collapsed:before {         
            /* symbol for "collapsed" panels */    

             content:"\f0fe";
            }
            .panel-heading {
                cursor: pointer;
            }
        </style>
        
    </head>
    <body>
        <div id="headerDIV">







<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        
        <title>Welcome Swapneel Layek to ERP, IIT Kharagpur</title>
        <script>
            $(function () {
            

                var request = $.ajax({
                    url: "getModules.htm",
                    type: "POST",
                    cache: false
                });
                request.done(function (json) {
                    var inhtml = "";

                    json.sort(function (a, b) {
                        return (a.display_order - b.display_order);
                    });

                    $.each(json, function (index, item) {
                        if (index === 9) {
                            inhtml += "<li class='dropdown'> " +
                                    "<a aria-expanded='true' href='#' class='dropdown-toggle' data-toggle='dropdown'><i class='fa fa-bars fa-lg fa-border'></i> More <b class='caret'></b></a> " +
                                    "<ul class='dropdown-menu'>";
                        }
                        inhtml += "<li><a href='menulist.htm?module_id=" + item.module_id + "'><i class='fa " + item.fa_icon + " fa-lg'></i> <strong>" + item.module_short_desc + "</strong></a></li>";
                    });
                    if (json.length > 7) {
                        inhtml += "</ul></li>";
                    }
                    $("#moduleUL").html(inhtml);
                });
            });

            function showSwitch() {
                var request = $.ajax({
                    url: "getSwitchableUsers.htm",
                    type: "POST",
                    cache: false
                });
                request.done(function (json) {
                    $('#switchModalLabel').html('List of account available for switching');
                    var cnt = 0;
                    $('#switchModalBody').html("");
                    if (json.length > 0) {
                        $.each(json, function (index, item) {
                            $('#switchModalBody').append("<div class='row'>");
                            $('#switchModalBody').append("<div class='well well-sm col-lg-4' style='margin-bottom: 0px;'><a href='#' onclick='switchUser(\"" + item.switch_code + "\")'>" + item.switch_code + "</a></div><div class='well well-sm col-lg-8' style='margin-bottom: 0px;'>" + item.switch_name + "</div>");
                            $('#switchModalBody').append("</div>");
                        });
                    } else {
                        $('#switchModalBody').append("<div class='row'>");
                        $('#switchModalBody').append("<div class='well well-sm' style='margin-bottom: 0px;'>No account available for switching</div>");
                        $('#switchModalBody').append("</div>");
                    }

                    $('#switchModalFooter').html('<button type="button" class="btn btn-primary" ');
                    $('#switchModal').modal('show');
                });
            }

            function switchUser(switch_code) {
                var f = document.createElement("form");
                f.setAttribute('method', "post");
                f.setAttribute('action', "switchacc.htm");

                var switch_code_el = document.createElement("input"); //input element, text
                switch_code_el.setAttribute('type', "text");
                switch_code_el.setAttribute('name', "switch_code");
                switch_code_el.setAttribute('value', switch_code);
                f.appendChild(switch_code_el);

                document.getElementsByTagName('body')[0].appendChild(f);
                f.submit();
            }

            var xmlHttp;
            function GetXmlHttpObject()
            {
                var xmlHttp = null;
                try
                {
                    // Firefox, Opera 8.0+, Safari
                    xmlHttp = new XMLHttpRequest();
                } catch (e)
                {
                    // Internet Explorer
                    try
                    {
                        xmlHttp = new ActiveXObject("Msxml2.XMLHTTP");
                    } catch (e)
                    {
                        xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
                    }
                }
                return xmlHttp;
            }

            function autoRunHoldSession() {
                setTimeout("autoRunCallHoldSession()", 27 * 60 * 1000);
            }
            function autoRunCallHoldSession() {
                holdSessionAjax();
                setTimeout("autoRunCallHoldSession()", 27 * 60 * 1000);
            }
            function holdSessionAjax() {
                xmlHttp = GetXmlHttpObject();
                if (xmlHttp == null)
                {
                    alert("Your browser does not support AJAX! Please install latest version of browsing software.");
                    return;
                }
                //var url="./holdSession.jsp?rand_id="+Math.round(Math.random()*100000);
                var url = "./holdSession.htm?rand_id=" + Math.round(Math.random() * 1000000000000000);
                xmlHttp.onreadystatechange = holdSession;
                xmlHttp.open("GET", url, true);
                xmlHttp.send(null);
                //alert("here11");
                //setTimeout(getPendingCAS(ca_user_code),100000);
                return true;
            }
            function holdSession()
            {
                var temp_html = "";
                if (xmlHttp.readyState == 4)
                {
                    temp_html = xmlHttp.responseText;
                    //alert(temp_html);
                }
            }
            function showComplaintSelection() {
                $('#complaintSelectionModal').modal('show');
//                $('#complaintSelectionModal').modal({
//                    backdrop: 'static',
//                    keyboard: false
//                });
            }
            function redirectComplaint(val) {
                var url = "showext.htm?link=other_complaint";
                if (val === "ERP") {
                    url = "complaint.htm";
                }
                window.location.href = url;
            }
            /*
             $(function(){
             $.ajax({
             type: "POST",
             url: 'getOtherInstComplaintList.htm',
             cache: false,
             //                    data:{"complaint_id":complaint_id},
             datatype: 'json',
             success: function (data) {
             //                        alert(JSON.stringify(data));
             
             if(data.length>0){
             //                            alert(data.length);
             $("#other_com").empty();
             var html_txt = '';
             $.each(data, function (key, val) {
             html_txt+='<div class="col-sm-4">'+
             '<div class="form-group">'+
             '<button type="button" class="btn btn-primary btn-sm" onclick="redirectComplaint()">'+val.desc+'</button>'+
             '</div>'+
             '</div>';
             });
             //                            $("#other_com").html(html_txt);
             }                                              
             }
             });
             });*/

            $(function () {
                //verifyInfo();
            });

            $(function () {
                $('#save_info_btn').click(function () {
                    saveInfo();
                });

                $('#close_modal_btn').click(function () {
                    $('#data_correction_modal').modal('hide');
                });
            });

            function verifyInfo() {
                //alert("https://erp.iitkgp.ac.in");
                $.ajax({
                    url: "https://erp.iitkgp.ac.in/ERPAccounts/verifyInfo.htm",
                    type: "POST",
                    cache: false,
                    dataType: "json",
                    success: function (json)
                    {
                        if (json.status === "invalid") {
                            var bank_msg = "";
                            var email_error = false;
                            for (var i = 0; i < json.data.length; i++) {
                                var obj = json.data[i];
                                if (obj.hasOwnProperty("ifsc_code")) {
                                    //$('#ifsc_code').val(obj.ifsc_code);
                                    if (obj.flag === "false") {
                                        //$('#ifsc_code_label').prop('hidden', false);
                                        bank_msg = bank_msg + " IFSC Code,";
                                    }
                                } else if (obj.hasOwnProperty("account_no")) {
                                    //$('#account_no').val(obj.account_no);
                                    if (obj.flag === "false") {
                                        //$('#account_no_label').prop('hidden', false);
                                        bank_msg = bank_msg + " Bank Account No,";
                                    }
                                } else if (obj.hasOwnProperty("email")) {
                                    $('#email').val(obj.email);
                                    if (obj.flag === "false") {
                                        $('#email_label').prop('hidden', false);
                                        email_error = true;
                                    }
                                } else if (obj.hasOwnProperty("pan")) {
                                    //$('#pan').val(obj.pan);
                                    if (obj.flag === "false") {
                                        //$('#pan_label').prop('hidden', false);
                                        bank_msg = bank_msg + " PAN No,";
                                    }
                                }
                            }
                            bank_msg = bank_msg.substring(0, bank_msg.length - 1);
                            if (bank_msg.length > 0) {
                                $('.bank_data').text(bank_msg);
                                $('.incorrect_info_msg').prop('hidden', false);
                            }
                            if (email_error === false) {
                                $('#close_button_row').prop('hidden', false);
                            }
                            $('#data_correction_modal').modal('show');
                        } else if (json.status === "error") {
                            alert(json.msg);
                            $('#data_correction_modal').modal('hide');
                        } else {
                            $('#data_correction_modal').modal('hide');
                        }
                    }
                });
            }

            function saveInfo() {
                var email = $('#email').val();
                $.ajax({
                    url: "https://erp.iitkgp.ac.in/ERPAccounts/saveCorrectedInfo.htm",
                    type: "POST",
                    cache: false,
                    dataType: "json",
                    data: {email: email},
                    success: function (json)
                    {
                        if (json.status === "success") {
                            $('#data_correction_modal').modal('hide');
                            alert("Thank You! Saved Successfully!")
                        } else {
                            alert(json.msg);
                            $('#data_correction_modal').modal('show');
                        }
                    }
                });
            }
        </script>

        <style>
            .glyphicon { margin-right:10px; }
            .panel-body { padding:0px; }
            .panel-body table tr td { padding-left: 15px }
            .panel-body .table {margin-bottom: 0px; }
            .navbar {margin-bottom: 0px; }
        </style>

    </head>
    <!--<body onload="autoRunHoldSession()">-->
    <body>
        <div class="container-fluid">
            <div class="row">
                <div class="navbar navbar-inverse">
                    
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-inverse-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <a class="navbar-brand" href="#"><label>ERP System, IITKGP</label></a>
                    </div>
                    <div class="navbar-collapse collapse navbar-inverse-collapse">
                        <ul class="nav navbar-nav">
                            <li><a href="home.htm"><i class="fa fa-home fa-lg"></i> Home</a></li>
                            <li>
                                <a href="#" onclick="showComplaintSelection()">
                                    <i class="fa fa-pencil-square-o fa-lg"></i> Feature requests / Complaints 
                                    <span class="badge" style="background-color: lightgray; color: white">0</span>
                                </a>
                            </li>
                            <li><a href="forgotpassphrase.htm"><i class="fa fa-key fa-lg"></i> Retrieve Passphrase</a></li>
                        </ul>
                        <ul class="nav navbar-nav navbar-right">
                            <li><a href="#"><label>Welcome Swapneel Layek (22ME10087)</label></a></li>
                            <li><a href="#" onclick="showSwitch()"><i class="fa fa-exchange fa-lg"></i> Switch Login</a></li>
                            <li><a href="logout.htm"><i class="fa fa-sign-out fa-lg"></i> Logout</a></li>
                        </ul>
                    </div>
                    <div class="incorrect_info_msg" hidden="true">
                        <p class="alert-danger"> **Please make correction of following info in your profile page: <span class="alert-info bank_data" id="bank_data2"></span>. Salary may be stopped if not corrected.** </p>
                    </div>
                </div>  
            </div>

            <div class="row">
                <div class="navbar navbar-default">
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <a class="navbar-brand hidden-lg hidden-md" href="#"><label>Modules</label></a>
                    </div>
                    <div style="height: 1px;" aria-expanded="false" class="navbar-collapse navbar-responsive-collapse collapse">
                        <ul id="moduleUL" class="nav navbar-nav" style="margin-top: 5px; margin-bottom: 5px;"><li><a href="menulistmodule_id16.htm"><i class="fa fa-graduation-cap fa-lg"></i> <strong>Academic</strong></a></li><li><a href="menulistmodule_id30.htm"><i class="fa fa-building fa-lg"></i> <strong>Guest House</strong></a></li><li><a href="menulistmodule_id26.htm"><i class="fa fa-industry fa-lg"></i> <strong>CDC</strong></a></li></ul>
                        <ul class="nav navbar-nav navbar-right" style="margin-top: 5px; margin-bottom: 5px;">
                            <li>
                                <form class="navbar-form navbar-left" method="post" action="searchmenu.htm">
                                    <input class="form-control col-lg-8" placeholder="Search Menu" name="s_string" type="text">
                                </form>
                            </li>
                        </ul>
                    </div>
                </div>                
            </div>
        </div>
        <div class="modal fade" id="switchModal" tabindex="-1" role="dialog" aria-labelledby="switchModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="switchModalLabel"></h4>
                    </div>
                    <div class="modal-body">
                        <div id="switchModalBody" class="container-fluid"></div>
                    </div>
                    <div class="modal-footer" id="switchModalFooter"></div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="mandatoryModal" tabindex="-1" role="dialog" aria-labelledby="mandatoryModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title" id="mandatoryModalLabel"></h4>
                    </div>
                    <div class="modal-body">
                        <div id="mandatoryModalBody" class="container-fluid"></div>
                    </div>
                    <div class="modal-footer" id="mandatoryModalFooter"></div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="complaintSelectionModal">
            <div class="modal-dialog" style="width: 50%">
                <div class="modal-content">
                    <div class="modal-header bg-info">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h3 class="modal-title" id="">Complaint / Feature Request Type Selection</h3>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-sm-12">
                                <h4 class="">Feature requests / complaints to administrative sections</h4>
                                <hr />
                            </div>
                            <div class="col-sm-12" id="other_com">
                                <div class="col-sm-12">
                                    <div class="form-group">
                                        <button type="button" class="btn btn-primary btn-sm" onclick="redirectComplaint('')">Administrative feature requests / complaints</button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-12">
                                <br />
                                <br />
                                <h4 class="">Feature requests / complaints to ERP section</h4>                                
                                <span class="text-danger small"> In case of data related issues, please contact respective sections. For technical difficulties in ERP, please lodge a complaint here.</span>
                                <hr style="margin-top: 8px;" />
                            </div>
                            <div class="col-sm-12">
                                <div class="col-sm-12">
                                    <div class="form-group">
                                        <button type="button" class="btn btn-info btn-sm" onclick="redirectComplaint('ERP')">ERP feature requests / complaints <span class="badge" style="background-color: lightgray; color: white">0</span></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--                        <button type="button" class="btn btn-primary" onclick="redirectComplaint('ERP')">ERP Related Complaints / Requests</button>&nbsp;&nbsp;
                                                <button type="button" class="btn btn-primary" onclick="redirectComplaint('OTH')">Other Institute Related Complaints / Requests</button>-->
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal" id="data_correction_modal" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="bankInfoCollectionLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <!--<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>-->
                        <h4 class="modal-title" id="title_id">Incorrect Data. Please make correction immediately.</h4>
                        <h5 class="modal-title" id="title_id">**Payment may not be processed without correct information**</h5>                    
                    </div>
                    <div class="modal-body">
                        <form method="POST" modelAttribute="dataInfo" id="data_correction_info">   
                            <div class="row" id="email_label" hidden="true">
                                <div class="col-sm-12 form-group">
                                    <label for="email">Email: (hint: name@gmail.com)</label>
                                    <input type="text" class="form-control" name="email" id="email" placeholder="Enter email" autocomplete="off"/>
                                    <button type="button" class="btn btn-primary m-1" id="save_info_btn">Save</button>
                                </div>
                            </div>                                                         
                        </form>
                        <div class="row">
                            <div class="col-sm-12 form-group">
                                <div class="incorrect_info_msg" hidden="true">
                                    <p class="alert-danger"> ** Please make correction of following info in your profile page: <span class="alert-info bank_data" id="bank_data2"></span>. Salary may be stopped if not corrected. ** </p>
                                </div>
                            </div>                            
                        </div>
                        <div class="row" id="close_button_row" hidden="true">
                            <div class="col-sm-12">
                                <button type="button" class="btn btn-primary m-1" id="close_modal_btn">Close</button>
                            </div>
                        </div>                     
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
</div>
        
        <div class="cointainer-fluid" style="min-height: 550px">
                <ul class="breadcrumb" style="margin-bottom: 0px">
                    You are in: 
                    <li><a href="menulistmodule_id30.htm">Guest House</a></li>
                </ul>
                <div class="row">
                    <div class="col-lg-12">
                        <div class="panel-group" style="padding-top: 5px" id="accordion"><div class="panel panel-info"><div class="panel-heading accordion-toggle collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapse303"><h3 class="panel-title"><a class="text-primary">Booking</a></h3></div><div id="collapse303" class="panel-collapse collapse"><div class="panel-body"><div class="well well-sm col-lg-4" style="margin-bottom: 0px;"><a href="#" onclick="window.location.href = 'showmenu4.htm';" class="text-default">Guest House Availability</a> <a href="#" onclick="showInfo('30', '9')"><i class="fa fa-info-circle fa-border pull-right"></i></a></div><div class="well well-sm col-lg-4" style="margin-bottom: 0px;"><a href="#" onclick="window.location.href = 'showmenu5.htm';" class="text-default">Initiate Booking (Student)</a> <a href="#" onclick="showInfo('30', '12')"><i class="fa fa-info-circle fa-border pull-right"></i></a></div></div></div></div></div>
                    </div>
                </div>
        </div>
        <div id="footerDIV" class="push-bottom">


<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>ERP System - IIT Kharagpur</title>
    </head>
    <body>
        <div class="container-fluid">
            <div class="row">
                <div class="navbar navbar-inverse">
                    <div class="navbar-collapse collapse navbar-inverse-collapse">
                        <ul class="nav navbar-nav">
                            <li><a href="#"><label>Copyright © ERP System, IIT Kharagpur. Helpline - 032222-81019/81018/81017</label></a></li>
                        </ul>
                        <ul class="nav navbar-nav navbar-right">
                            <li>
                                <!--table width="135" border="0" cellpadding="2" cellspacing="0" title="Click to Verify - This site chose Symantec SSL for secure e-commerce and confidential communications.">
                                    <tr>
                                        <td width="135" align="center" valign="top"><script type="text/javascript" src="https://seal.verisign.com/getseal?host_name=erp.iitkgp.ac.in&amp;size=XS&amp;use_flash=NO&amp;use_transparent=NO&amp;lang=en"></script><br />
                                            <a href="http://www.symantec.com/verisign/ssl-certificates" target="_blank"  style="color:#000000; text-decoration:none; font:bold 7px verdana,sans-serif; letter-spacing:.5px; text-align:center; margin:0px; padding:0px;">ABOUT SSL CERTIFICATES</a>
                                        </td>
                                    </tr>
                                </table-->
                            </li>
                        </ul>
                    </div>
                </div>
                
                
            </div>
        </div>
    </body>
</html>
</div>
        
        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="myModalLabel"></h4>
                    </div>
                    <div class="modal-body" id="myModalBody"></div>
                    <div class="modal-footer" id="myModalFooter"></div>
                </div>
            </div>
        </div>
        
        <div class="modal fade" id="delegateModal" tabindex="-1" aria-labelledby="delegateModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="refundModalLabel">Delegate Menu</h4>
                    </div>
                    <form id="delegateForm" action="showdelegate.htm" method="post">
                        <div class="modal-body" id="delegateModalBody">
                            <table id="delegateTable" class="table table-bordered table-condensed table-hover"></table>
                        </div>
                        <div class="modal-footer">
                            <button type="submit" class="btn btn-info">Proceed</button>
                            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
    </body>
    <script>
        
        function sortObjects(objArray, properties /*, primers*/) {
            var primers = arguments[2] || {};

            properties = properties.map(function(prop) {
                if( !(prop instanceof Array) ) {
                    prop = [prop, 'asc']
                }
                if( prop[1].toLowerCase() == 'desc' ) {
                    prop[1] = -1;
                } else {
                    prop[1] = 1;
                }
                return prop;
            });

            function valueCmp(x, y) {
                return x > y ? 1 : x < y ? -1 : 0; 
            }

            function arrayCmp(a, b) {
                var arr1 = [], arr2 = [];
                properties.forEach(function(prop) {
                    var aValue = a[prop[0]],
                        bValue = b[prop[0]];
                    if( typeof primers[prop[0]] != 'undefined' ) {
                        aValue = primers[prop[0]](aValue);
                        bValue = primers[prop[0]](bValue);
                    }
                    arr1.push( prop[1] * valueCmp(aValue, bValue) );
                    arr2.push( prop[1] * valueCmp(bValue, aValue) );
                });
                return arr1 < arr2 ? -1 : 1;
            }

            objArray.sort(function(a, b) {
                return arrayCmp(a, b);
            });
        }
        
        
        $(function() {
            
            var request = $.ajax({
                url: "getMenus.htm?module_id=30",
                type: "POST",
                cache: false,
            });
            request.done(function(json) {
                var inhtml = "";
                var prv_parent = "";
                sortObjects(json, [['parent_display_name', 'asc'], ['display_name', 'asc']]);
                
                $.each(json, function(index, item) {
                    if (item.parent_display_name !== prv_parent) {
                        if(prv_parent !== ""){
                            inhtml += "</div></div></div>"; //closing div of earlier panel-body
                        }
                        inhtml += "<div class='panel panel-info'>"+
                                  "<div class='panel-heading accordion-toggle collapsed' data-toggle='collapse' data-parent='#accordion' href='#collapse"+item.module_id+item.parent_menu_id+"'>"+
                                  "<h3 class='panel-title'><a class='text-primary'>" 
                                  
                                  + item.parent_display_name+"</a></h3>"+
                                  "</div>";
                        inhtml += "<div id='collapse"+item.module_id+item.parent_menu_id+"' class='panel-collapse collapse'><div class='panel-body'>";
                    }
                    var menuclass = '';
                    if(item.active_status === 'N')
                        menuclass = 'danger';
                    else if(item.delegated_by !== '')
                        menuclass = 'warning';
                    else
                        menuclass = 'default';
                    //alert(item);
                    inhtml += "<div class='well well-sm col-lg-4' style='margin-bottom: 0px;'>"+
                              //"<div class='bg-"+menuclass+"'>" + 
                              "<a href='#' onclick=\"showMenu('"+item.module_id+"','"+item.menu_id+"','"+item.link+"','"+item.delegated_by+"','"+item.active_status+"', '"+item.module_name+"', '"+item.parent_display_name+"', '"+item.display_name+"')\" class='text-"+menuclass+"'>" + item.display_name + "</a>  "+
                              "<a href='#' onclick=\"showInfo('"+item.module_id+"', '"+item.menu_id+"')\"><i class='fa fa-info-circle fa-border pull-right'></i></a> " + 
                              ((item.can_be_delegated==="Y" && item.active_status === 'Y')?"<a href='#' onclick=\"delegate('"+item.module_id+"', '"+item.module_name+"','"+item.menu_id+"', '"+item.display_name+"')\" title='Delegate'><i class='fa fa-mail-forward fa-border pull-right'></i></a> ":"") + 
                              "</div>";
                    prv_parent = item.parent_display_name;
                });
                if(json.length > 0)
                    inhtml += "</div></div></div>";
                $("#accordion").html(inhtml);  
            });
        });

        function showMenu(p_module_id, p_menu_id, p_link, p_delegated_by, p_active_status, p_module_name, p_parent_display_name, p_display_name){
            
            if(p_active_status === 'N'){
                showInfo(p_module_id, p_menu_id);
                return;
            }
        
            if(p_delegated_by === ''){
                forwardToShowmenu(p_module_id, p_menu_id, p_link, p_delegated_by, p_module_name, p_parent_display_name, p_display_name)
            }
            else if(p_delegated_by !== '')
            {
                var btnHtml = '';
                var useAsStr = '';
                var delByArr = p_delegated_by.split(",");
                for(var i = 0; i < delByArr.length; i++){
                    //alert(delByArr[i]);
                    var request = $.ajax({
                        url: "getStakeholderName.htm?user_code="+delByArr[i],
                        type: "POST",
                        cache: false,
                        async: false
                    });
                    request.done(function(response) {
                        useAsStr += ((useAsStr==='')?response:(', ' + response));
                        btnHtml += '<button type="button" class="btn btn-warning" onclick="forwardToShowmenu(\''+p_module_id+'\',\''+p_menu_id+'\',\''+p_link+'\',\''+delByArr[i]+'\',\''+p_module_name+'\',\''+p_parent_display_name+'\',\''+p_display_name+'\')">'+response+'</button>';
                    });
                }
                
                $('#myModalLabel').html('Confirmation ');
                $('#myModalBody').html('This menu is delegated to you (with all credentials) by <strong>'+useAsStr+'</strong>. \n\
                                        Kindly click on proper button to get access with corrosponding credentials.');
                $('#myModalFooter').html(btnHtml + '<button type="button" class="btn btn-primary" onclick="forwardToShowmenu(\''+p_module_id+'\',\''+p_menu_id+'\',\''+p_link+'\',\'\',\''+p_module_name+'\',\''+p_parent_display_name+'\',\''+p_display_name+'\')">Swapneel Layek</button>');
                $('#myModal').modal('show');
            }
        }
        
        function forwardToShowmenu(p_module_id, p_menu_id, p_link, p_delegated_by, p_module_name, p_parent_display_name, p_display_name){
            var f = document.createElement("form");
            f.setAttribute('method',"post");
            f.setAttribute('action',"showmenu.htm");

            var module_id = document.createElement("input"); //input element, text
            module_id.setAttribute('type',"text");
            module_id.setAttribute('name',"module_id");
            module_id.setAttribute('value',p_module_id);
            f.appendChild(module_id);
            
            var menu_id = document.createElement("input"); //input element, text
            menu_id.setAttribute('type',"text");
            menu_id.setAttribute('name',"menu_id");
            menu_id.setAttribute('value',p_menu_id);
            f.appendChild(menu_id);
            
            var link = document.createElement("input"); //input element, text
            link.setAttribute('type',"text");
            link.setAttribute('name',"link");
            link.setAttribute('value',p_link);
            f.appendChild(link);
            
            if(delegated_by !== ''){
                var delegated_by = document.createElement("input"); //input element, text
                delegated_by.setAttribute('type',"text");
                delegated_by.setAttribute('name',"delegated_by");
                delegated_by.setAttribute('value',p_delegated_by);
                f.appendChild(delegated_by);
            }
            
            var module_name = document.createElement("input"); //input element, text
            module_name.setAttribute('type',"text");
            module_name.setAttribute('name',"module_name");
            module_name.setAttribute('value',p_module_name);
            f.appendChild(module_name);
            
            var parent_display_name = document.createElement("input"); //input element, text
            parent_display_name.setAttribute('type',"text");
            parent_display_name.setAttribute('name',"parent_display_name");
            parent_display_name.setAttribute('value',p_parent_display_name);
            f.appendChild(parent_display_name);
            
            var display_name = document.createElement("input"); //input element, text
            display_name.setAttribute('type',"text");
            display_name.setAttribute('name',"display_name");
            display_name.setAttribute('value',p_display_name);
            f.appendChild(display_name);
            
            document.getElementsByTagName('body')[0].appendChild(f);
            f.submit();
        }

        function showInfo(module_id, menu_id){
            $('#myModalBody').html('<i class="fa fa-spinner fa-spin"></i> Please wait, loading access information');
            $('#myModalFooter').html('<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>');
            $('#myModal').modal('show');
            
            var tab_html = '';
            tab_html = '<table class="table table-stripped table-hover"><tbody>';
                
            var request = $.ajax({
                url: "getMenuAccessInfo.htm?module_id="+module_id+"&menu_id="+menu_id,
                type: "POST",
                cache: false,
                async: false
            });
            request.done(function(json) {
                $.each(json, function(index, item){
                    $('#myModalLabel').html(item.menu_name);
                    if(item.is_delegated === 'N'){
                        tab_html += ('<tr class="info"><td>Access As : </td><td>'+item.access_as_desc+ '</td></tr>');
                        tab_html += ('<tr><td>Activated By : </td><td>'+(item.activated_by.startsWith("D")?"ERP SYSTEM":item.activated_by_name) + '</td></tr>');
                    }
                    else{
                        tab_html += ('<tr class="info"><td>Access As : </td><td>Delegated by '+ item.delegated_by_name + '</td></tr>');
                    }
                    tab_html += ('<tr><td>Duration : </td><td>'+item.activated_from + ' - ' + item.activated_to +'</td></tr>');
                    tab_html += ('<tr><td>Active Status : </td><td><label  class="'+(item.active_status==='Y'?'text-success':'text-danger')+'">'+(item.active_status==='Y'?'YES':'NO')+'</lable></td></tr>');
                });
            });
            
            
                    
            tab_html += '</tbody></table>';
            $('#myModalBody').html(tab_html);
        }
        
        
        
        
        //var delegated_menus = new Array();
        function delegate(module_id, module_name, menu_id, display_name){
            var form_data = '';
            form_data += '<input type="hidden" name="module_id" value="'+module_id+'">';
            form_data += '<input type="hidden" name="menu_id" value="'+menu_id+'">';
            var location = 'showdelegate.htm';
            $('<form action="'+location+'" method="POST">'+form_data+'</form>').appendTo('body').submit();
        }
    </script>
</html>

